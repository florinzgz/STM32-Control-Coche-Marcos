; =============================================================================
; ESP32-S3 HMI Firmware — PlatformIO Configuration
;
; Framework:  Arduino ONLY (no ESP-IDF)
; Language:   C++ (C++17)
; Board:      ESP32-S3-DevKitC-1
; Display:    320×480 TFT via TFT_eSPI (ST7796 driver)
; CAN Bus:    500 kbps via TJA1051 transceiver (GPIO4 TX, GPIO5 RX)
;
; Reference:  docs/ESP32_FIRMWARE_DESIGN.md
;             docs/CAN_CONTRACT_FINAL.md rev 1.3
;             docs/HMI_RENDERING_STRATEGY.md
; =============================================================================

[env:esp32s3]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

; C++ standard
build_flags =
    -std=gnu++17
    -Wall
    -Wextra
    -DARDUINO_USB_CDC_ON_BOOT=1
    ; --- TFT_eSPI configuration (ST7796, 320×480) ---
    -DUSER_SETUP_LOADED=1
    -DST7796_DRIVER=1
    -DTFT_WIDTH=320
    -DTFT_HEIGHT=480
    -DTFT_MISO=-1
    -DTFT_MOSI=13
    -DTFT_SCLK=14
    -DTFT_CS=15
    -DTFT_DC=16
    -DTFT_RST=17
    -DTFT_BL=42
    -DTFT_BACKLIGHT_ON=1
    -DSPI_FREQUENCY=40000000
    -DSPI_READ_FREQUENCY=20000000
    -DTOUCH_CS=21
    -DSPI_TOUCH_FREQUENCY=2500000
    -DLOAD_GLCD=1
    -DLOAD_FONT2=1
    -DLOAD_FONT4=1
    -DSMOOTH_FONT=1

build_unflags =
    -std=gnu++11

; Serial monitor
monitor_speed = 115200

; Library dependencies
lib_deps =
    handmade0octopus/ESP32-TWAI-CAN@^1.0.1
    bodmer/TFT_eSPI@^2.5.43
